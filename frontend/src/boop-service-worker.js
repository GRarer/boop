// custom service worker
console.log("boop custom service worker version 3");
try {
  // import and extend the default service worker generated by Angular
  importScripts('./ngsw-worker.js');
  // listen for push notification clicks
  self.addEventListener('notificationclick', (event) => {
    console.log('notification clicked!');
    console.log(event);
    const action = event.action;
    if (action === "show_app") {
      console.log("navigating");
      event.notification.close();
      event.waitUntil(clients.openWindow("http://localhost:8080/test"));
    }
  });
} catch (err) {
  if (
    err instanceof DOMException
    && err.name === "NetworkError"
    && err.message.includes(`Failed to execute 'importScripts' on 'WorkerGlobalScope'`)
  ) {
    console.warn(
      "Service worker not enabled. PWA features including push notifications will not be available.\n\n"
      + "This is expected behavior when using Angular's `ng serve` dev server.\n"
      + "For a local server that supports service workers, use `npm run start-pwa` instead."
    );
  } else {
    throw err;
  }
}
